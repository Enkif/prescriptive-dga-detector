Testing Guide for the Prescriptive DGA Detector
This document outlines the manual verification steps to ensure the DGA detection pipeline is working as expected.

Prerequisites
Before starting, ensure you have:

Cloned the repository and navigated into the project directory.

Installed all dependencies from requirements.txt.

Executed python 1_train_and_export.py at least once to train the model and generate DGA_Leader.zip in the model directory and dga_dataset_train.csv in the root.

Manual Verification Steps
Follow these steps to test the 2_analyze_domain.py script with different domain types.

Test Case 1: Known Legitimate Domain
This test verifies that the system correctly identifies a legitimate domain and does not generate a SHAP explanation or a playbook.

Command to Run:

python 2_analyze_domain.py --domain google.com

Expected Output (Console):

Analyzing domain: google.com
[H2O Initialization messages]
Loading MOJO model from ./model/DGA_Leader.zip...
Model loaded successfully.

Prediction for 'google.com':
  Predicted Class: Legitimate (raw: 0)
  DGA Probability: [a low probability, e.g., 0.0012]
Predicted as Legitimate. No SHAP explanation or playbook generated.
[H2O cluster shut down message]

Verification:

Confirm the "Predicted Class" is "Legitimate".

Confirm the "DGA Probability" is a very low number (close to 0).

Confirm the message "Predicted as Legitimate. No SHAP explanation or playbook generated." appears.

Test Case 2: Known DGA Domain (Example from Synthetic Data)
This test verifies that the system correctly identifies a DGA domain, provides a SHAP explanation, and generates an incident response playbook. The exact domain might be one generated by 1_train_and_export.py earlier.

Command to Run:

python 2_analyze_domain.py --domain kq3v9z7j1x5f8g2h.info

(Note: You can try other randomly generated DGA-like domains such as a9b2c3d4e5f6g7.com or x1y2z3a4b5c6.net if the above doesn't yield a DGA classification with high confidence.)

Expected Output (Console):

Analyzing domain: kq3v9z7j1x5f8g2h.info
[H2O Initialization messages]
Loading MOJO model from ./model/DGA_Leader.zip...
Model loaded successfully.

Prediction for 'kq3v9z7j1x5f8g2h.info':
  Predicted Class: DGA (raw: 1)
  DGA Probability: [a high probability, e.g., 0.9980]

Generating SHAP explanation...
SHAP explanation generated.

--- XAI Findings for GenAI ---
- Alert: Potential DGA domain detected.
- Domain: 'kq3v9z7j1x5f8g2h.info'
- AI Model Explanation (from SHAP): The model flagged this domain with [high percentage] confidence.
  The classification was primarily driven by:
  - A 'entropy' value of [X.XX] (which strongly pushed the prediction towards 'dga').
  - A 'length' value of [Y.YY] (which also pushed the prediction towards 'dga').

Generating incident response playbook with GenAI...

--- Incident Response Playbook ---
**Detected DGA Domain: kq3v9z7j1x5f8g2h.info**

**Analysis Summary (from AI):** The domain's high entropy (approx. [X.XX]) and considerable length ([Y] characters) were key indicators leading to its classification as a DGA with [high percentage] confidence.

**Actionable Steps:**
1.  **Immediate Blocking:** Add `kq3v9z7j1x5f8g2h.info` to network perimeter defenses...
2.  **DNS Query Logging Review:** Check internal DNS logs for any clients...
3.  **Endpoint Investigation:** Isolate any identified client machines...
[... and so on, with several actionable steps]
[H2O cluster shut down message]

Verification:

Confirm the "Predicted Class" is "DGA".

Confirm the "DGA Probability" is a high number (close to 1).

Verify that the "--- XAI Findings for GenAI ---" section appears and accurately describes the influence of length and entropy based on the values for the input domain.

Verify that the "--- Incident Response Playbook ---" section appears and contains relevant, actionable steps for a cybersecurity analyst.

Test Case 3: Invalid or Missing Model
This test verifies the error handling when the MOJO model file is not found.

Steps:

Temporarily move or rename model/DGA_Leader.zip (e.g., to model/DGA_Leader_temp.zip).

Run the command: python 2_analyze_domain.py --domain test.com

Expected Output (Console):

Analyzing domain: test.com
[H2O Initialization messages]
Error: MOJO model not found at ./model/DGA_Leader.zip.
Please run 1_train_and_export.py first to train and export the model.
[H2O cluster shut down message]

Verification:

Confirm the specific error message indicating the model was not found and suggesting to run 1_train_and_export.py.

Remember to move/rename DGA_Leader.zip back after this test!
